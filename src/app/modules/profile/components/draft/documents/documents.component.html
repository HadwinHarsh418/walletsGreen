<div class="documents-container">
    <div>
        <p class="question">ID: Please upload a photo/scan of your passport/drivers licence</p>

        <div *ngIf="idDocument" class="d-flex w-100 align-items-center mt-2">
            <mat-chip-list aria-label="Fish selection" class="mw-75">
                <mat-chip [removable]="true" (removed)="removeDoc('idDocument')">
                    <span class="d-inline-block text-truncate">{{idDocument.fileName}}</span>
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
            </mat-chip-list>
            <button mat-mini-fab
                    color="primary"
                    class="ml-4"
                    (click)="download(idDocument.key)"
                    matTooltip="Download"
                    [disabled]="(downloadPending$ | async)"
            >
                <mat-icon>cloud_download</mat-icon>
            </button>
        </div>

        <div *ngIf="!idDocument && idFile" class="d-flex w-100 align-items-center mt-2">
            <mat-chip-list class="mw-75">
                <mat-chip [removable]="true" (removed)="removeFile('idFile')">
                    <span class="d-inline-block text-truncate">{{idFile.name}}</span>
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
            </mat-chip-list>

            <button
                mat-mini-fab
                color="primary"
                class="mx-4"
                matTooltip="Upload"
                [disabled]="!idFile"
                (click)="upload('idFile', 'idDocument')"
            >
                <mat-icon>cloud_upload</mat-icon>
            </button>
        </div>

        <div *ngIf="!idDocument && !idFile" class="input-file-wrapper mt-2">
            <input type="file"
                   class="file-input"
                   accept=".pdf, .png, .jpeg"
                   (change)="onFileChange($event, 'idFile')"
                   #idFileInput>
            <button mat-stroked-button color="primary" (click)="importFile('idFileInput')" type="button">
                Import file
            </button>
        </div>

        <mat-accordion>
            <mat-expansion-panel class="mat-elevation-z0">
                <mat-expansion-panel-header>
                    <mat-panel-title class="expansion">
                        ID Requirements
                    </mat-panel-title>
                    <mat-panel-description class="expansion">

                    </mat-panel-description>
                </mat-expansion-panel-header>

                <p class="expansion">A current valid Passport or Drivers Licence is required for ID
                    verification.
                    If using a Drivers Licence please upload both front and back parts of the licence.
                </p>
            </mat-expansion-panel>
        </mat-accordion>
    </div>

    <mat-divider></mat-divider>

    <div class="mt-3">
        <p class="question">Address: Please upload a photo/scan of a utility bill/bank statement</p>

        <div *ngIf="addressDocument" class="d-flex w-100 align-items-center mt-2">
            <mat-chip-list aria-label="Fish selection" class="mw-75">
                <mat-chip [removable]="true" (removed)="removeDoc('addressDocument')">
                    <span class="d-inline-block text-truncate">{{addressDocument.fileName}}</span>
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
            </mat-chip-list>
            <button mat-mini-fab
                    color="primary"
                    class="ml-4"
                    (click)="download(addressDocument.key)"
                    matTooltip="Download"
                    [disabled]="(downloadPending$ | async)"
            >
                <mat-icon>cloud_download</mat-icon>
            </button>
        </div>

        <div *ngIf="!addressDocument && addressFile" class="d-flex w-100 align-items-center mt-2">
            <mat-chip-list class="mw-75">
                <mat-chip [removable]="true" (removed)="removeFile('addressFile')">
                    <span class="d-inline-block text-truncate">{{addressFile.name}}</span>
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
            </mat-chip-list>

            <button
                mat-mini-fab
                color="primary"
                class="mx-4"
                matTooltip="Upload"
                [disabled]="!addressFile"
                (click)="upload('addressFile', 'addressDocument')"
            >
                <mat-icon>cloud_upload</mat-icon>
            </button>
        </div>

        <div *ngIf="!addressDocument && !addressFile" class="input-file-wrapper mt-2">
            <input type="file"
                   class="file-input"
                   accept=".pdf, .png, .jpeg"
                   (change)="onFileChange($event, 'addressFile')"
                   #addressFileInput>
            <button mat-stroked-button color="primary" (click)="importFile('addressFileInput')" type="button">
                Import file
            </button>
        </div>

        <mat-accordion>
            <mat-expansion-panel class="mat-elevation-z0">
                <mat-expansion-panel-header>
                    <mat-panel-title class="expansion">
                        Address Validation Requirements
                    </mat-panel-title>
                    <mat-panel-description class="expansion">
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <p class="expansion">
                    A current utility bill or bank statement is required that clearly states your name as it
                    appears on your uploaded ID along with your residential address.
                    Please note any document uploaded cannot be older than 3 months.
                </p>
            </mat-expansion-panel>
        </mat-accordion>
    </div>

    <mat-divider></mat-divider>

    <div class="mt-3">
        <p class="question">Tax: Please upload a document showing your Tax Number</p>
        <div *ngIf="taxDocument" class="d-flex w-100 align-items-center mt-2">
            <mat-chip-list aria-label="Fish selection" class="mw-75">
                <mat-chip [removable]="true" (removed)="removeDoc('taxDocument')">
                    <span class="d-inline-block text-truncate">{{taxDocument.fileName}}</span>
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
            </mat-chip-list>
            <button mat-mini-fab
                    color="primary"
                    class="ml-4"
                    (click)="download(taxDocument.key)"
                    matTooltip="Download"
                    [disabled]="(downloadPending$ | async)"
            >
                <mat-icon>cloud_download</mat-icon>
            </button>
        </div>

        <div *ngIf="!taxDocument && taxFile" class="d-flex w-100 align-items-center mt-2">
            <mat-chip-list class="mw-75">
                <mat-chip [removable]="true" (removed)="removeFile('taxFile')">
                    <span class="d-inline-block text-truncate">{{taxFile.name}}</span>
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
            </mat-chip-list>

            <button
                mat-mini-fab
                color="primary"
                class="mx-4"
                matTooltip="Upload"
                [disabled]="!taxFile"
                (click)="upload('taxFile', 'taxDocument')"
            >
                <mat-icon>cloud_upload</mat-icon>
            </button>
        </div>

        <div *ngIf="!taxDocument && !taxFile" class="input-file-wrapper mt-2">
            <input type="file"
                   class="file-input"
                   accept=".pdf, .png, .jpeg"
                   (change)="onFileChange($event, 'taxFile')"
                   #taxFileInput>
            <button mat-stroked-button color="primary" (click)="importFile('taxFileInput')" type="button">
                Import file
            </button>
        </div>

        <mat-accordion>
            <mat-expansion-panel class="mat-elevation-z0">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!smallScreen" class="expansion">
                        You may need documentation showing your Tax Number
                    </mat-panel-title>
                    <mat-panel-title *ngIf="smallScreen" class="small-expansion">
                        You may need documentation showing your Tax Number
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <p class="expansion">We are required by law to collect and verify your Taxation Number or
                    Tax Reference Number.
                    This is required by the Central Bank for customer identification. </p>
            </mat-expansion-panel>
        </mat-accordion>
    </div>

    <div class="d-flex w-100 justify-content-between align-items-center mt-3">
        <p class="text-red m-0">{{status === 'rejected' && (user$ | async).role === 'Merchant' ?
            'This section is rejected by admin. Please update the information again.' : ''}}</p>
    </div>

    <div *ngIf="((user$ | async).role === 'Admin' || (user$ | async).role === 'SuperAdmin')
            && (merchantDetail$ | async)?.kycInfoStatus !== 'approved'
            && (merchantDetail$ | async)?.kycInfoStatus !== 'rejected'"
         class="d-flex align-items-center my-4">
    <span class="mr-4">
        Do you agree with this information?
    </span>
        <button mat-stroked-button color="primary" class="mr-3" (click)="approveSection()">Approve</button>
        <button mat-stroked-button color="accent" (click)="rejectSection()">Reject</button>
    </div>
</div>

<div class="hr-sect mt-3">Last Comments</div>

<div class="my-3" *ngIf="comments.length === 0">
    <p class="text-danger">No comments</p>
</div>

<div class="comment-list my-3" *ngIf="comments.length > 0">
    <div *ngFor="let comment of (comments | lastComments)" class="comment-item">
        <p class="mb-1">{{ comment.content }}</p>
        <div class="d-flex w-100 align-items-center justify-content-end">
            <span class="mr-3 comment-info">{{ comment.userEmail }}</span>
            <span class="comment-info">{{ comment.createdAt }}</span>
        </div>
    </div>
</div>
<div class="d-flex w-100 justify-content-end">
    <button mat-raised-button
            color="primary"
            (click)="openDialog()"
    >
        Add comment
    </button>
</div>
